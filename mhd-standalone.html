<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Earth MHD Simulation - Standalone</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background: #000011;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 5px;
            max-width: 300px;
        }
        #controls {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 5px;
            font-family: Arial;
        }
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
        }
    </style>
</head>
<body>
    <div id="loading">Loading MHD Simulation...</div>
    <div id="info" style="display: none;">
        <h2>MHD Simulation</h2>
        <p><strong>Earth's Magnetosphere</strong></p>
        <p>This shows the interaction between the solar wind and Earth's magnetic field.</p>
        <ul>
            <li>Blue sphere: Earth</li>
            <li>White lines: Magnetic field</li>
            <li>Colored lines: Solar wind flow</li>
        </ul>
    </div>
    
    <div id="controls" style="display: none;">
        <h3>Controls</h3>
        <button id="pauseBtn">Pause</button>
        <p style="font-size: 12px; margin-top: 10px;">
            Use mouse to rotate view<br>
            Scroll to zoom in/out
        </p>
    </div>

    <!-- Import Three.js from CDN -->
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.161.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.161.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // Simple MHD visualization
        class SimpleMHD {
            constructor() {
                this.init();
                this.createScene();
                this.animate();
                
                // Hide loading, show controls
                document.getElementById('loading').style.display = 'none';
                document.getElementById('info').style.display = 'block';
                document.getElementById('controls').style.display = 'block';
            }
            
            init() {
                // Scene
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0x000011);
                
                // Camera
                this.camera = new THREE.PerspectiveCamera(
                    45,
                    window.innerWidth / window.innerHeight,
                    0.1,
                    1000
                );
                this.camera.position.set(30, 20, 30);
                
                // Renderer
                this.renderer = new THREE.WebGLRenderer({ antialias: true });
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                document.body.appendChild(this.renderer.domElement);
                
                // Controls
                this.controls = new OrbitControls(this.camera, this.renderer.domElement);
                this.controls.enableDamping = true;
                
                // Lights
                this.scene.add(new THREE.AmbientLight(0x404040));
                const light = new THREE.DirectionalLight(0xffffff, 0.5);
                light.position.set(1, 1, 0);
                this.scene.add(light);
                
                // Resize handler
                window.addEventListener('resize', () => this.onResize());
                
                // Pause button
                this.isPaused = false;
                document.getElementById('pauseBtn').addEventListener('click', () => {
                    this.isPaused = !this.isPaused;
                    document.getElementById('pauseBtn').textContent = this.isPaused ? 'Resume' : 'Pause';
                });
            }
            
            createScene() {
                // Earth
                const earthGeometry = new THREE.SphereGeometry(1, 32, 32);
                const earthMaterial = new THREE.MeshPhongMaterial({
                    color: 0x2233ff,
                    emissive: 0x112244,
                    shininess: 10
                });
                this.earth = new THREE.Mesh(earthGeometry, earthMaterial);
                this.scene.add(this.earth);
                
                // Magnetic field lines
                this.fieldLines = new THREE.Group();
                
                // Create simple dipole field lines
                for (let i = 0; i < 8; i++) {
                    const angle = (i / 8) * Math.PI * 2;
                    const curve = new THREE.CatmullRomCurve3([
                        new THREE.Vector3(Math.cos(angle) * 2, 3, Math.sin(angle) * 2),
                        new THREE.Vector3(Math.cos(angle) * 4, 5, Math.sin(angle) * 4),
                        new THREE.Vector3(Math.cos(angle) * 5, 0, Math.sin(angle) * 5),
                        new THREE.Vector3(Math.cos(angle) * 4, -5, Math.sin(angle) * 4),
                        new THREE.Vector3(Math.cos(angle) * 2, -3, Math.sin(angle) * 2)
                    ]);
                    
                    const points = curve.getPoints(50);
                    const geometry = new THREE.BufferGeometry().setFromPoints(points);
                    const material = new THREE.LineBasicMaterial({ color: 0xffffff, opacity: 0.5, transparent: true });
                    const line = new THREE.Line(geometry, material);
                    this.fieldLines.add(line);
                }
                
                this.scene.add(this.fieldLines);
                
                // Solar wind particles
                this.particles = new THREE.Group();
                const particleGeometry = new THREE.SphereGeometry(0.05, 4, 4);
                
                for (let i = 0; i < 50; i++) {
                    const material = new THREE.MeshBasicMaterial({
                        color: new THREE.Color().setHSL(0.1, 0.8, 0.6)
                    });
                    const particle = new THREE.Mesh(particleGeometry, material);
                    particle.position.set(
                        15 + Math.random() * 5,
                        (Math.random() - 0.5) * 10,
                        (Math.random() - 0.5) * 10
                    );
                    particle.userData = {
                        velocity: new THREE.Vector3(-5, 0, 0),
                        startX: particle.position.x
                    };
                    this.particles.add(particle);
                }
                
                this.scene.add(this.particles);
                
                // Magnetopause (simple sphere section)
                const magnetopauseGeometry = new THREE.SphereGeometry(
                    8, 32, 32,
                    0, Math.PI,
                    0, Math.PI
                );
                const magnetopauseMaterial = new THREE.MeshBasicMaterial({
                    color: 0x00ff00,
                    transparent: true,
                    opacity: 0.1,
                    wireframe: true
                });
                const magnetopause = new THREE.Mesh(magnetopauseGeometry, magnetopauseMaterial);
                magnetopause.rotation.y = -Math.PI / 2;
                this.scene.add(magnetopause);
                
                // Grid helper
                const grid = new THREE.GridHelper(20, 20, 0x444444, 0x222222);
                grid.rotation.x = Math.PI / 2;
                this.scene.add(grid);
            }
            
            animate() {
                requestAnimationFrame(() => this.animate());
                
                if (!this.isPaused) {
                    // Rotate field lines
                    this.fieldLines.rotation.y += 0.001;
                    
                    // Move particles
                    this.particles.children.forEach(particle => {
                        particle.position.add(particle.userData.velocity.clone().multiplyScalar(0.02));
                        
                        // Reset particle if it goes too far
                        if (particle.position.x < -10) {
                            particle.position.x = particle.userData.startX;
                        }
                        
                        // Deflect particles near Earth
                        const dist = particle.position.length();
                        if (dist < 8) {
                            const deflection = particle.position.clone().normalize().multiplyScalar(0.1);
                            particle.position.add(deflection);
                        }
                    });
                }
                
                this.controls.update();
                this.renderer.render(this.scene, this.camera);
            }
            
            onResize() {
                this.camera.aspect = window.innerWidth / window.innerHeight;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(window.innerWidth, window.innerHeight);
            }
        }
        
        // Start when loaded
        window.addEventListener('load', () => {
            new SimpleMHD();
        });
    </script>
</body>
</html>