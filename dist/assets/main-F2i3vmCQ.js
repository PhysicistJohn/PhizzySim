import{B as v,C as V,F as w,P as L,A as S,a as G,S as E,M as z,b as x,c as O,d as D,e as X,f as Z,G as b,L as C,g as A,h as Y,R as W,D as F,T as U,i as J,j as K,k as Q,l as tt,W as et,m as st,O as it,n as nt,o as at}from"./OrbitControls-B7EN8c73.js";class ot{constructor(){this.G=66743e-15,this.earthMass=5972e21,this.earthRadius=6371e3,this.moonMass=7342e19,this.moonDistance=3844e5,this.sunMass=1989e27,this.earthOrbitRadius=1496e8,this.rotationPeriod=24*3600,this.orbitalPeriod=365.25*24*3600,this.axialTilt=23.44*Math.PI/180,this.time=0,this.dayOfYear=0}updateTime(t,e=1){this.time+=t*e,this.dayOfYear=this.time/this.rotationPeriod%365.25}getEarthRotation(){return this.time/this.rotationPeriod*2*Math.PI}getEarthOrbitAngle(){return this.time/this.orbitalPeriod*2*Math.PI}getEarthPosition(){const t=this.getEarthOrbitAngle();return{x:Math.cos(t)*this.earthOrbitRadius,y:0,z:Math.sin(t)*this.earthOrbitRadius}}getMoonPosition(t){const a=this.time/2358720*2*Math.PI;return{x:t.x+Math.cos(a)*this.moonDistance,y:Math.sin(a)*this.moonDistance*.1,z:t.z+Math.sin(a)*this.moonDistance}}getSeason(){const e=this.getEarthOrbitAngle()%(2*Math.PI);return e<Math.PI/2?"Spring":e<Math.PI?"Summer":e<3*Math.PI/2?"Autumn":"Winter"}getSurfaceGravity(){return this.G*this.earthMass/(this.earthRadius*this.earthRadius)}getOrbitalVelocity(t){return Math.sqrt(this.G*this.sunMass/t)}getTidalForce(t){const e=this.moonDistance,a=2*this.G*this.moonMass*this.earthRadius/Math.pow(e,3),s=this.earthOrbitRadius,i=2*this.G*this.sunMass*this.earthRadius/Math.pow(s,3);return{moon:a,sun:i,total:a+i}}getAtmosphericPressure(t){return 101325*Math.exp(-t/8500)}getDayNightPosition(t,e){const a=this.getEarthRotation(),s=(e/360+a/(2*Math.PI))*24,i=(s-12)*15*Math.PI/180,o=this.axialTilt*Math.sin(this.getEarthOrbitAngle()),r=Math.asin(Math.sin(t)*Math.sin(o)+Math.cos(t)*Math.cos(o)*Math.cos(i));return{isDay:r>0,sunAltitude:r*180/Math.PI,localTime:s%24}}}function rt(){const n=new E(6371e3,128,128),t=new O({color:2241535,emissive:1122884,shininess:10,map:dt(),bumpMap:ut(),bumpScale:1e5,specularMap:mt(),specular:new V("grey")}),e=new x(n,t);return e.castShadow=!0,e.receiveShadow=!0,e}function ht(){const n=new E(1737e3,64,64),t=new O({color:11184810,emissive:2236962,shininess:5,map:pt()}),e=new x(n,t);return e.castShadow=!0,e.receiveShadow=!0,e}function ct(){const n=new E(696e6,64,64),t=new z({color:16776960,emissive:16776960,emissiveIntensity:1}),e=new x(n,t),a=new E(696e6*1.3,64,64),s=new z({color:16755200,transparent:!0,opacity:.3,blending:S}),i=new x(a,s);return e.add(i),e}function lt(){const n=new v,t=[],e=[];for(let s=0;s<1e4;s++){const i=Math.random()*Math.PI*2,o=Math.random()*Math.PI,r=1e12;t.push(r*Math.sin(o)*Math.cos(i),r*Math.sin(o)*Math.sin(i),r*Math.cos(o));const h=new V;h.setHSL(.6*Math.random(),.7,.9),e.push(h.r,h.g,h.b)}n.setAttribute("position",new w(t,3)),n.setAttribute("color",new w(e,3));const a=new L({size:1e9,vertexColors:!0,blending:S,transparent:!0,sizeAttenuation:!1});return new G(n,a)}function dt(){const n=document.createElement("canvas");n.width=2048,n.height=1024;const t=n.getContext("2d"),e=t.createLinearGradient(0,0,0,n.height);e.addColorStop(0,"#ffffff"),e.addColorStop(.1,"#aaddff"),e.addColorStop(.3,"#0066cc"),e.addColorStop(.5,"#004499"),e.addColorStop(.7,"#0066cc"),e.addColorStop(.9,"#aaddff"),e.addColorStop(1,"#ffffff"),t.fillStyle=e,t.fillRect(0,0,n.width,n.height);for(let a=0;a<7;a++){const s=Math.random()*n.width,i=n.height*(.3+Math.random()*.4),o=Math.random()*400+200,r=Math.random()*200+100;t.fillStyle=`hsl(${Math.random()*60+60}, 50%, 40%)`,t.beginPath(),t.ellipse(s,i,o,r,Math.random()*Math.PI,0,Math.PI*2),t.fill()}return new D(n)}function ut(){const n=document.createElement("canvas");n.width=1024,n.height=512;const t=n.getContext("2d");t.fillStyle="#000000",t.fillRect(0,0,n.width,n.height);for(let e=0;e<5;e++){const a=Math.random()*n.width,s=n.height*(.3+Math.random()*.4),i=Math.random()*200+100,o=Math.random()*100+50,r=t.createRadialGradient(a,s,0,a,s,Math.max(i,o));r.addColorStop(0,"#ffffff"),r.addColorStop(1,"#000000"),t.fillStyle=r,t.beginPath(),t.ellipse(a,s,i,o,Math.random()*Math.PI,0,Math.PI*2),t.fill()}return new D(n)}function mt(){const n=document.createElement("canvas");n.width=1024,n.height=512;const t=n.getContext("2d"),e=t.createLinearGradient(0,0,0,n.height);e.addColorStop(0,"#000000"),e.addColorStop(.3,"#ffffff"),e.addColorStop(.5,"#ffffff"),e.addColorStop(.7,"#ffffff"),e.addColorStop(1,"#000000"),t.fillStyle=e,t.fillRect(0,0,n.width,n.height);for(let a=0;a<7;a++){const s=Math.random()*n.width,i=n.height*(.3+Math.random()*.4),o=Math.random()*400+200,r=Math.random()*200+100;t.fillStyle="#000000",t.beginPath(),t.ellipse(s,i,o,r,Math.random()*Math.PI,0,Math.PI*2),t.fill()}return new D(n)}function pt(){const n=document.createElement("canvas");n.width=1024,n.height=512;const t=n.getContext("2d");t.fillStyle="#cccccc",t.fillRect(0,0,n.width,n.height);for(let e=0;e<100;e++){const a=Math.random()*n.width,s=Math.random()*n.height,i=Math.random()*20+5,o=Math.random()*100+100;t.fillStyle=`rgb(${o}, ${o}, ${o})`,t.beginPath(),t.arc(a,s,i,0,Math.PI*2),t.fill()}return new D(n)}function Mt(){const n=`
        varying vec3 vNormal;
        varying vec3 vPosition;
        
        void main() {
            vNormal = normalize(normalMatrix * normal);
            vPosition = position;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
    `,t=`
        varying vec3 vNormal;
        varying vec3 vPosition;
        
        void main() {
            float intensity = pow(0.7 - dot(vNormal, vec3(0.0, 0.0, 1.0)), 2.0);
            vec3 atmosphere = vec3(0.3, 0.6, 1.0) * intensity;
            
            float height = length(vPosition) - 6.371e6;
            float density = exp(-height / 8500.0);
            
            gl_FragColor = vec4(atmosphere, density * intensity);
        }
    `,e=new E(7008100000000001e-9,64,64),a=new X({vertexShader:n,fragmentShader:t,blending:S,side:Z,transparent:!0});return new x(e,a)}class yt{constructor(){this.earthRadius=6371e3,this.earthMagneticMoment=79e21,this.solarWindVelocity=4e5,this.solarWindDensity=5e6,this.solarWindPressure=2e-9,this.solarWindTemperature=1e5,this.solarWindMagneticField=5e-9,this.mu0=4*Math.PI*1e-7,this.magnetopauseDistance=10*this.earthRadius,this.bowShockDistance=13.5*this.earthRadius,this.innerBeltRadius=1.2*this.earthRadius,this.outerBeltRadius=4*this.earthRadius,this.particles=[],this.maxParticles=1e3,this.initializeParticles()}getDipoleField(t){const e=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);if(e/this.earthRadius<1)return{x:0,y:0,z:0};const s=Math.acos(t.z/e),i=Math.atan2(t.y,t.x),o=this.mu0*this.earthMagneticMoment/(4*Math.PI*Math.pow(e,3)),r=2*o*Math.cos(s),h=o*Math.sin(s),l=r*Math.sin(s)*Math.cos(i)+h*Math.cos(s)*Math.cos(i),d=r*Math.sin(s)*Math.sin(i)+h*Math.cos(s)*Math.sin(i),u=r*Math.cos(s)-h*Math.sin(s);return{x:l,y:d,z:u}}getMagnetopauseDistance(t){const e=this.magnetopauseDistance;return t<=Math.PI/2?e*Math.pow(2/(1+Math.cos(t)),.5):e*(1+.5*(t-Math.PI/2))}getBowShockDistance(t){return this.bowShockDistance*Math.pow(2/(1+Math.cos(t)),.5)}isInsideMagnetosphere(t){const e=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z),a=Math.acos(t.x/e),s=this.getMagnetopauseDistance(a);return e<s}initializeParticles(){this.particles=[];for(let t=0;t<this.maxParticles;t++){const e=(Math.random()-.5)*100*this.earthRadius+20*this.earthRadius,a=(Math.random()-.5)*40*this.earthRadius,s=(Math.random()-.5)*40*this.earthRadius;this.particles.push({position:{x:e,y:a,z:s},velocity:{x:-this.solarWindVelocity,y:0,z:0},mass:167e-29,charge:16e-20,active:!0,type:"proton"})}}updateParticles(t){for(let e of this.particles){if(!e.active)continue;const a=Math.sqrt(e.position.x*e.position.x+e.position.y*e.position.y+e.position.z*e.position.z);if(a>50*this.earthRadius||a<this.earthRadius){this.resetParticle(e);continue}const s=this.getDipoleField(e.position);if(Math.sqrt(s.x*s.x+s.y*s.y+s.z*s.z)>0&&this.isInsideMagnetosphere(e.position)){const o=e.charge/e.mass,r=o*(e.velocity.y*s.z-e.velocity.z*s.y),h=o*(e.velocity.z*s.x-e.velocity.x*s.z),l=o*(e.velocity.x*s.y-e.velocity.y*s.x);e.velocity.x+=r*t,e.velocity.y+=h*t,e.velocity.z+=l*t}e.position.x+=e.velocity.x*t,e.position.y+=e.velocity.y*t,e.position.z+=e.velocity.z*t}}resetParticle(t){const e=(Math.random()-.5)*100*this.earthRadius+20*this.earthRadius,a=(Math.random()-.5)*40*this.earthRadius,s=(Math.random()-.5)*40*this.earthRadius;t.position={x:e,y:a,z:s},t.velocity={x:-this.solarWindVelocity,y:0,z:0},t.active=!0}traceFieldLine(t,e=100,a=1e5){const s=[{...t}];let i={...t};for(let o=0;o<e;o++){const r=this.getDipoleField(i),h=Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z);if(h===0)break;const l={x:r.x/h,y:r.y/h,z:r.z/h};i.x+=l.x*a,i.y+=l.y*a,i.z+=l.z*a;const d=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z);if(d<this.earthRadius||d>20*this.earthRadius)break;s.push({...i})}return s}}function ft(n){const t=new b,e=new v,a=[];for(let c=0;c<=Math.PI;c+=.2)for(let M=0;M<=2*Math.PI;M+=.2){const y=n.getMagnetopauseDistance(c),g=y*Math.sin(c)*Math.cos(M),R=y*Math.sin(c)*Math.sin(M),P=y*Math.cos(c);a.push(g,R,P)}e.setAttribute("position",new w(a,3));const s=new L({color:4521796,size:1e3,transparent:!0,opacity:.1,sizeAttenuation:!1}),i=new G(e,s);t.add(i);const o=new v,r=[];for(let c=0;c<=Math.PI;c+=.3)for(let M=0;M<=2*Math.PI;M+=.3){const y=n.getBowShockDistance(c),g=y*Math.sin(c)*Math.cos(M),R=y*Math.sin(c)*Math.sin(M),P=y*Math.cos(c);r.push(g,R,P)}o.setAttribute("position",new w(r,3));const h=new L({color:16755370,size:1e3,transparent:!0,opacity:.1,sizeAttenuation:!1}),l=new G(o,h);t.add(l);const d=new v,u=new Float32Array(n.maxParticles*3),p=new Float32Array(n.maxParticles*3);for(let c=0;c<n.maxParticles;c++){const M=n.particles[c];u[c*3]=M.position.x,u[c*3+1]=M.position.y,u[c*3+2]=M.position.z;const y=n.isInsideMagnetosphere(M.position);p[c*3]=y?.3:1,p[c*3+1]=y?.3:.9,p[c*3+2]=y?.8:.3}d.setAttribute("position",new Y(u,3)),d.setAttribute("color",new Y(p,3));const m=new L({size:1e3,vertexColors:!0,transparent:!0,opacity:.2,sizeAttenuation:!1,blending:S}),f=new G(d,m);t.add(f);const B=gt(n);return B.userData.isFieldLine=!0,t.add(B),t.userData={updateParticles:function(c){const M=f.geometry.attributes.position.array,y=f.geometry.attributes.color.array;for(let g=0;g<c.particles.length;g++){const R=c.particles[g];M[g*3]=R.position.x,M[g*3+1]=R.position.y,M[g*3+2]=R.position.z;const P=c.isInsideMagnetosphere(R.position);y[g*3]=P?0:1,y[g*3+1]=0,y[g*3+2]=P?1:0}f.geometry.attributes.position.needsUpdate=!0,f.geometry.attributes.color.needsUpdate=!0}},t}function gt(n){const t=new b,e=[];for(let a=-80;a<=80;a+=20)for(let s=0;s<360;s+=45){const i=a*Math.PI/180,o=s*Math.PI/180;for(let r=1.5;r<=6;r+=1.5){const h=n.earthRadius*r,l=h*Math.cos(i)*Math.cos(o),d=h*Math.cos(i)*Math.sin(o),u=h*Math.sin(i);e.push({x:l,y:d,z:u,lat:a,lon:s})}}e.forEach((a,s)=>{const i=n.traceFieldLine(a,200,5e4),r=[...n.traceFieldLine(a,200,-5e4).reverse(),...i.slice(1)];if(r.length>5){const h=new v,l=[],d=[];r.forEach((m,f)=>{l.push(m.x,m.y,m.z);const B=Math.sqrt(m.x*m.x+m.y*m.y+m.z*m.z),c=Math.max(.3,1-(B-n.earthRadius)/(10*n.earthRadius));Math.abs(a.lat)>60?d.push(.3*c,.8*c,1*c):Math.abs(a.lat)<30?d.push(1*c,.7*c,.2*c):d.push(.8*c,.8*c,1*c)}),h.setAttribute("position",new w(l,3)),h.setAttribute("color",new w(d,3));const u=new C({vertexColors:!0,transparent:!0,opacity:.6,linewidth:2}),p=new A(h,u);t.add(p)}});for(let a=0;a<Math.PI;a+=Math.PI/12)for(let s=0;s<2*Math.PI;s+=Math.PI/8){const i=n.earthRadius*1.2,o=i*Math.sin(a)*Math.cos(s),r=i*Math.sin(a)*Math.sin(s),h=i*Math.cos(a),l=n.traceFieldLine({x:o,y:r,z:h},100,2e4);if(l.length>3){const d=new v,u=[];l.forEach(f=>{u.push(f.x,f.y,f.z)}),d.setAttribute("position",new w(u,3));const p=new C({color:8978431,transparent:!0,opacity:.4,linewidth:1}),m=new A(d,p);t.add(m)}}return t}function wt(){const n=new b,t=696e6,e=[];for(let a=-75;a<=75;a+=15)for(let s=0;s<360;s+=30){const i=a*Math.PI/180,o=s*Math.PI/180;for(let r=1.1;r<=3;r+=.3){const h=t*r,l=h*Math.cos(i)*Math.cos(o),d=h*Math.cos(i)*Math.sin(o),u=h*Math.sin(i);e.push({x:l,y:d,z:u,lat:a})}}e.forEach(a=>{const s=[];let i={...a};for(let o=0;o<50;o++){s.push({...i});const h=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z)/t,l=.1*h,d=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z),u={x:i.x/d+Math.sin(l)*.1,y:i.y/d+Math.cos(l)*.1,z:i.z/d},p=t*.1*(1+h*.5);if(i.x+=u.x*p,i.y+=u.y*p,i.z+=u.z*p,Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z)>t*20)break}if(s.length>5){const o=new v,r=[],h=[];s.forEach((u,p)=>{r.push(u.x,u.y,u.z);const m=Math.max(.2,1-p/s.length);Math.abs(a.lat)>45?h.push(1*m,1*m,.8*m):h.push(1*m,.6*m,.2*m)}),o.setAttribute("position",new w(r,3)),o.setAttribute("color",new w(h,3));const l=new C({vertexColors:!0,transparent:!0,opacity:.7,linewidth:2}),d=new A(o,l);n.add(d)}});for(let a=0;a<20;a++){const s=(Math.random()-.5)*60*Math.PI/180,i=Math.random()*2*Math.PI,o=t*(.2+Math.random()*.5),r=new v,h=[],l=[];for(let p=0;p<=Math.PI;p+=.1){const m=t*1.05,f=m*Math.cos(s)*Math.cos(i+p*.1)+o*Math.sin(p)*Math.cos(i),B=m*Math.cos(s)*Math.sin(i+p*.1)+o*Math.sin(p)*Math.sin(i),c=m*Math.sin(s)+o*Math.sin(p)*.3;h.push(f,B,c);const M=Math.sin(p)*.8+.2;l.push(1*M,.8*M,.3*M)}r.setAttribute("position",new w(h,3)),r.setAttribute("color",new w(l,3));const d=new C({vertexColors:!0,transparent:!0,opacity:.6}),u=new A(r,d);n.add(u)}return n}function xt(){const n=new b,t=1496e8;for(let e=0;e<2*Math.PI;e+=Math.PI/6){const a=[];let s=1392e6,i=e;for(;s<t*2;){const o=s*Math.cos(i),r=s*Math.sin(i);a.push({x:o,y:r,z:0});const d=-27e-7/4e5;s+=t*.05,i+=d*t*.05}if(a.length>5){const o=new v,r=[],h=[];a.forEach((u,p)=>{r.push(u.x,u.y,u.z);const m=Math.max(.2,1-p/a.length);h.push(.8*m,.8*m,.3*m)}),o.setAttribute("position",new w(r,3)),o.setAttribute("color",new w(h,3));const l=new C({vertexColors:!0,transparent:!0,opacity:.3,linewidth:1}),d=new A(o,l);n.add(d)}}return n}class Rt{constructor(){this.earthRadius=6371e3,this.innerBelt={minRadius:1.2*this.earthRadius,maxRadius:2.5*this.earthRadius,intensity:1,particleType:"proton"},this.outerBelt={minRadius:3*this.earthRadius,maxRadius:7*this.earthRadius,intensity:.8,particleType:"electron"},this.slotRegion={minRadius:this.innerBelt.maxRadius,maxRadius:this.outerBelt.minRadius,intensity:.1},this.particleDensity=this.calculateParticleDensity.bind(this)}calculateParticleDensity(t){const s=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)/this.earthRadius;let i=0,o="none";if(s>=this.innerBelt.minRadius/this.earthRadius&&s<=this.innerBelt.maxRadius/this.earthRadius){const r=(this.innerBelt.minRadius+this.innerBelt.maxRadius)/(2*this.earthRadius),h=(this.innerBelt.maxRadius-this.innerBelt.minRadius)/(2*this.earthRadius);i=this.innerBelt.intensity*Math.exp(-Math.pow((s-r)/h,2)),o="inner"}if(s>=this.outerBelt.minRadius/this.earthRadius&&s<=this.outerBelt.maxRadius/this.earthRadius){const r=(this.outerBelt.minRadius+this.outerBelt.maxRadius)/(2*this.earthRadius),h=(this.outerBelt.maxRadius-this.outerBelt.minRadius)/(2*this.earthRadius),l=this.outerBelt.intensity*Math.exp(-Math.pow((s-r)/h,2));l>i&&(i=l,o="outer")}return s>=this.slotRegion.minRadius/this.earthRadius&&s<=this.slotRegion.maxRadius/this.earthRadius&&i<this.slotRegion.intensity&&(i=this.slotRegion.intensity,o="slot"),{density:i,beltType:o,L:s}}getParticleFlux(t,e="electron"){const{density:a,beltType:s}=this.calculateParticleDensity(t);let i=a;return e==="proton"&&s==="inner"?i*=2:e==="electron"&&s==="outer"?i*=3:s==="slot"&&(i*=.1),i}getDriftVelocity(t,e="electron"){if(Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)<this.earthRadius)return{x:0,y:0,z:0};const{density:s}=this.calculateParticleDensity(t);if(s<.1)return{x:0,y:0,z:0};const i=e==="electron"?1e4:-1e4,o=Math.sqrt(t.x*t.x+t.y*t.y);return o===0?{x:0,y:0,z:0}:{x:-t.y*i/o,y:t.x*i/o,z:0}}}function Pt(n){const t=new b,e=new W(n.innerBelt.minRadius,n.innerBelt.maxRadius,32,16),a=new z({color:16746632,transparent:!0,opacity:.05,side:F}),s=new x(e,a);s.rotation.x=Math.PI/2,t.add(s);const i=new W(n.outerBelt.minRadius,n.outerBelt.maxRadius,32,16),o=new z({color:8947967,transparent:!0,opacity:.05,side:F}),r=new x(i,o);r.rotation.x=Math.PI/2,t.add(r);const h=new U((n.innerBelt.minRadius+n.innerBelt.maxRadius)/2,(n.innerBelt.maxRadius-n.innerBelt.minRadius)/4,16,32),l=new z({color:16737894,transparent:!0,opacity:.2,wireframe:!0}),d=new x(h,l);t.add(d);const u=new U((n.outerBelt.minRadius+n.outerBelt.maxRadius)/2,(n.outerBelt.maxRadius-n.outerBelt.minRadius)/4,16,32),p=new z({color:6711039,transparent:!0,opacity:.2,wireframe:!0}),m=new x(u,p);t.add(m);const f=new v,B=[],c=[];for(let g=0;g<500;g++){const R=Math.random()*Math.PI*2,P=Math.random()*Math.PI,k=n.earthRadius*(1.5+Math.random()*6),q=k*Math.sin(P)*Math.cos(R),N=k*Math.sin(P)*Math.sin(R),$=k*Math.cos(P),_={x:q,y:N,z:$},{density:H,beltType:j}=n.calculateParticleDensity(_);if(H>.1){B.push(q,N,$);let I=new V;j==="inner"?I.setRGB(1,.2,.2):j==="outer"?I.setRGB(.2,.2,1):I.setRGB(.5,.5,.5);const T=Math.min(H,1);c.push(I.r*T,I.g*T,I.b*T)}}f.setAttribute("position",new w(B,3)),f.setAttribute("color",new w(c,3));const M=new L({size:500,vertexColors:!0,transparent:!0,opacity:.1,blending:S,sizeAttenuation:!1}),y=new G(f,M);return t.add(y),t}function vt(n){const t=new b,e=new W(n.earthRadius*1.05,n.earthRadius*1.15,32,8),a=new z({color:65416,transparent:!0,opacity:.4,blending:S,side:F}),s=new x(e,a);s.position.z=n.earthRadius*.9,s.rotation.x=Math.PI/2,t.add(s);const i=new z({color:16711816,transparent:!0,opacity:.4,blending:S,side:F}),o=new x(e,i);return o.position.z=-n.earthRadius*.9,o.rotation.x=Math.PI/2,t.add(o),t.userData={animate:function(r){const h=.3+.2*Math.sin(r*2);a.opacity=h,i.opacity=h,s.rotation.z=Math.sin(r*.5)*.1,o.rotation.z=Math.sin(r*.5+Math.PI)*.1}},t}class Bt{constructor(){this.visualScale=1,this.physics=new ot,this.magnetosphere=new yt,this.radiationBelts=new Rt,this.timeMultiplier=1,this.isPaused=!1,this.clock=new J,this.showMagnetosphere=!0,this.showSolarWind=!0,this.showRadiationBelts=!0,this.showAurora=!0,this.showFieldLines=!0,this.init(),this.createScene(),this.setupControls(),this.animate()}init(){this.scene=new K,this.scene.fog=new Q(0,1e10,1e12);const t=window.innerWidth/window.innerHeight;this.camera=new tt(45,t,1e5,1e12),this.camera.position.set(0,0,5e11),this.renderer=new et({antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=st,document.body.appendChild(this.renderer.domElement),this.controls=new it(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.dampingFactor=.05,this.controls.minDistance=1e6,this.controls.maxDistance=1e12;const e=new nt(4210752,.2);this.scene.add(e),window.addEventListener("resize",()=>this.onWindowResize())}createScene(){this.stars=lt(),this.scene.add(this.stars),this.sun=ct(),this.scene.add(this.sun),this.sunFieldLines=wt(),this.sun.add(this.sunFieldLines);const t=new at(16777215,2,0);t.castShadow=!0,t.shadow.mapSize.width=2048,t.shadow.mapSize.height=2048,t.shadow.camera.near=1e9,t.shadow.camera.far=1e12,this.sun.add(t),this.earthGroup=new b,this.scene.add(this.earthGroup),this.earth=rt(),this.earthGroup.add(this.earth),this.atmosphere=Mt(),this.earthGroup.add(this.atmosphere),this.moon=ht(),this.scene.add(this.moon),this.clouds=this.createClouds(),this.earthGroup.add(this.clouds),this.magnetosphereGroup=ft(this.magnetosphere),this.scene.add(this.magnetosphereGroup),this.radiationBeltGroup=Pt(this.radiationBelts),this.earthGroup.add(this.radiationBeltGroup),this.auroraGroup=vt(this.radiationBelts),this.earthGroup.add(this.auroraGroup),this.interplanetaryField=xt(),this.scene.add(this.interplanetaryField)}createClouds(){const t=new E(6434710,64,64),e=new O({map:this.createCloudTexture(),transparent:!0,opacity:.4,blending:S,depthWrite:!1});return new x(t,e)}createCloudTexture(){const t=document.createElement("canvas");t.width=2048,t.height=1024;const e=t.getContext("2d");e.fillStyle="black",e.fillRect(0,0,t.width,t.height);for(let a=0;a<1e3;a++){const s=Math.random()*t.width,i=Math.random()*t.height,o=Math.random()*50+10,r=Math.random()*.5,h=e.createRadialGradient(s,i,0,s,i,o);h.addColorStop(0,`rgba(255, 255, 255, ${r})`),h.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=h,e.fillRect(s-o,i-o,o*2,o*2)}return new D(t)}setupControls(){document.getElementById("timeSpeed").addEventListener("input",t=>{this.timeMultiplier=parseFloat(t.target.value),document.getElementById("speedLabel").textContent=`${this.timeMultiplier}x`}),document.getElementById("pauseBtn").addEventListener("click",()=>{this.isPaused=!this.isPaused,document.getElementById("pauseBtn").textContent=this.isPaused?"Resume":"Pause"}),document.getElementById("resetBtn").addEventListener("click",()=>{this.physics.time=0,this.timeMultiplier=1,document.getElementById("timeSpeed").value=1,document.getElementById("speedLabel").textContent="1x"}),document.getElementById("viewEarth").addEventListener("click",()=>{const t=this.earthGroup.position;this.camera.position.set(t.x,t.y,t.z+3e7),this.controls.target.copy(this.earthGroup.position)}),document.getElementById("viewOrbit").addEventListener("click",()=>{this.camera.position.set(0,5e11,0),this.controls.target.set(0,0,0)}),document.getElementById("viewEarthSun").addEventListener("click",()=>{this.physics.getEarthPosition(),this.camera.position.set(0,2e11,1e11),this.controls.target.set(0,0,0)}),document.getElementById("showMagnetosphere").addEventListener("change",t=>{this.showMagnetosphere=t.target.checked,this.magnetosphereGroup.visible=this.showMagnetosphere}),document.getElementById("showSolarWind").addEventListener("change",t=>{this.showSolarWind=t.target.checked}),document.getElementById("showRadiationBelts").addEventListener("change",t=>{this.showRadiationBelts=t.target.checked,this.radiationBeltGroup.visible=this.showRadiationBelts}),document.getElementById("showAurora").addEventListener("change",t=>{this.showAurora=t.target.checked,this.auroraGroup.visible=this.showAurora}),document.getElementById("showFieldLines").addEventListener("change",t=>{this.showFieldLines=t.target.checked,this.sunFieldLines.visible=this.showFieldLines,this.interplanetaryField.visible=this.showFieldLines,this.magnetosphereGroup.children&&this.magnetosphereGroup.children.forEach(e=>{e.userData&&e.userData.isFieldLine&&(e.visible=this.showFieldLines)})}),document.getElementById("windSpeed").addEventListener("input",t=>{const e=parseFloat(t.target.value)*1e3;this.magnetosphere.solarWindVelocity=e,document.getElementById("windSpeedLabel").textContent=t.target.value}),document.getElementById("windDensity").addEventListener("input",t=>{const e=parseFloat(t.target.value)*1e6;this.magnetosphere.solarWindDensity=e,document.getElementById("windDensityLabel").textContent=t.target.value}),document.getElementById("windTemp").addEventListener("input",t=>{this.magnetosphere.solarWindTemperature=parseFloat(t.target.value),document.getElementById("tempLabel").textContent=t.target.value}),document.getElementById("windBField").addEventListener("input",t=>{this.magnetosphere.solarWindMagneticField=parseFloat(t.target.value)*1e-9,document.getElementById("bFieldLabel").textContent=t.target.value})}animate(){if(requestAnimationFrame(()=>this.animate()),!this.isPaused){const t=this.clock.getDelta();this.physics.updateTime(t*3600,this.timeMultiplier);const e=this.physics.getEarthRotation();this.earth.rotation.y=e,this.clouds.rotation.y=e*1.1;const a=this.physics.getEarthPosition();this.earthGroup.position.set(a.x/1e6*this.visualScale,a.y/1e6*this.visualScale,a.z/1e6*this.visualScale),this.earthGroup.rotation.z=this.physics.axialTilt;const s=this.physics.getMoonPosition(a);this.moon.position.set(s.x/1e6*this.visualScale,s.y/1e6*this.visualScale,s.z/1e6*this.visualScale),this.magnetosphere.updateParticles(t*this.timeMultiplier),this.magnetosphereGroup.userData.updateParticles&&this.magnetosphereGroup.userData.updateParticles(this.magnetosphere),this.auroraGroup.userData.animate&&this.auroraGroup.userData.animate(this.physics.time),this.updateInfo()}this.controls.update(),this.renderer.render(this.scene,this.camera)}updateInfo(){const t=Math.floor(this.physics.time/this.physics.rotationPeriod),e=Math.floor(this.physics.time%this.physics.rotationPeriod/3600),a=Math.floor(this.physics.time%3600/60);document.getElementById("day").textContent=t,document.getElementById("time").textContent=`${e.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`,document.getElementById("season").textContent=this.physics.getSeason()}onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}}new Bt;
